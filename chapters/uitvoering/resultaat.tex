\chapter{Resultaat}
In dit hoofdstuk zullen alle resultaten van de afstudeeropdracht beschreven worden. De resultaten zullen opgesplitst zijn in twee onderdelen. Ten eerste zal er teruggekoppeld worden op de doelstellingen en eisen. Ten tweede zal er gekeken worden of de Satellite voldoet aan het opgezette hardware testplan.

\section{Doelstellingen}
In het begin van het project zijn er drie doelstellingen gedefineerd, de doelstellingen hebben als taak om een overzicht te krijgen wat er precies bereikt zal moeten worden. De volgende doelstellingen zijn hieronder gedefineerd. De doelstellingen kunnen opgesplitst worden in twee onderdelen, het eerste onderdeel is hardwarevalidatie. Het tweede onderdeel focust zich op het onderdeel om een generieke applicatie en robuuste communicatie te ontwikkelen. In de volgende subhoofdstukken zal er gekeken worden per onderdeel wat het resultaat van de doelstelling is.
\begin{enumerate}
	\item De Satellite IO porten zijn volledig getest, en kunnen communiceren met sensoren.
	\item De Satellite heeft een robuuste communicatie over CAN en UDP.
	\item Generiek en modulair opgebouwde software, waardoor het in de toekomst makkelijk uitgebreid kan worden.
\end{enumerate}

\subsection{Hardware validatie}
Vanuit Sensor Maritime is er gevraagd om een manier te ontwikkelen om snel nieuwe hardware van de Satellite te kunnen testen. Hiervoor is een testplan ontwikkeld dat alle porten test. In dit testplan is beschreven welke porten getest wordt, wat de verwachting is en hoe het is aangesloten aan de microcontroller. Het testplan is opgesplitst in type porten. De Satellite heeft vijf verschillende porten, de porten zijn een DIP switch, digitaal output signaal, analoog input signaal, relay, en seriële porten. Voor elke type port is een aparte manier van testen bedacht. \newline

\noindent De hardwarevalidatie heeft ook een implementatie nodig, ten eerste moet er software geschreven worden voor de Satellite, en voor de desktop. De Satellite voert de handelingen uit zoals die beschreven zijn in het testplan, en de desktopapplicatie visualiseert. Het is nu zo opgebouwd dat de Satellite de resultaten van het testplan opstuurt naar de applicatie elke 250 milliseconden. \newline

\noindent Met de combinatie van alle onderdelen van de hardwarevalidatie kan Sensor Maritime in minuten bekijken of de hardware problemen heeft. Het testplan is ook uitgevoerd op de huidige Satellite, die de afstudeerder heeft gebruikt. De huidige Satellite heeft het testplan succesvol afgerond. In de toekomst kan Sensor Maritime het testplan gebruiken om nieuw hardware volledig te testen. 

\newpage
\subsubsection{Uitwerking testplan}
In tabel \ref{tab:hw_val_dip_testplan} is een uitwerking van het testplan. Alle porten zijn getest met het testplan en het resultaat is zoals verwacht.
\begin{table}[h!]
	\caption{Hardware validatie testplan uitwerking}
	\begin{tabular}{llp{12.25cm}c}
	\toprule
	\textbf{\#}	& \textbf{Naam} & \textbf{Verwachte resultaat} & \textbf{Voltooid}\\ \toprule
	\multicolumn{4}{l}{Dip Switch}   \\ \midrule
	1			& PU1			& Als het aangezet wordt de range van de analoge input 1 verhoogt naar 24 volt, dit verhoogt de waarde wat de microcontroller leest, de waarde wordt getoond op een GUI.	& X \\
	2			& PU2			& Als het aangezet wordt de range van de analoge input 2 verhoogt naar 24 volt, dit verhoogt de waarde wat de microcontroller leest, de waarde wordt getoond op een GUI.	& X \\
	3			& PU3			& Als het aangezet wordt de range van de analoge input 3 verhoogt  naar 24 volt, dit verhoogt de waarde wat de microcontroller leest, de waarde wordt getoond op een GUI.	& X \\
	4			& ADD0 			& Zet 3.3V op de pin van de microcontroller, als de microcontroller 3.3V detecteert wordt led 0 aangezet. & X \\
	5			& ADD1 			& Zet 3.3V op de pin van de microcontroller, als de microcontroller 3.3V detecteert wordt led 1 aangezet. & X \\
	6			& ADD2 			& Zet 3.3V op de pin van de microcontroller, als de microcontroller 3.3V detecteert wordt led 2 aangezet. & X \\
	7			& ADD3 			& Zet 3.3V op de pin van de microcontroller, als de microcontroller 3.3V detecteert wordt led 3 aangezet. & X \\ \midrule
	\multicolumn{4}{l}{Digital output signaal} \\ \midrule 
	8			& D1			&	Als op de pin 24V staat gaat het lampje aan, en bij 0V gaat het uit. Dit gebeurt om 1 seconden. & X \\
	9			& D2			&	Als op de pin 24V staat gaat het lampje aan, en bij 0V gaat het uit. Dit gebeurt om 1 seconden. & X \\
	10			& D3			&	Als op de pin 24V staat gaat het lampje aan, en bij 0V gaat het uit. Dit gebeurt om 1 seconden. & X \\
	11			& D4			&	Als op de pin 24V staat gaat het lampje aan, en bij 0V gaat het uit. Dit gebeurt om 1 seconden. & X \\ \bottomrule
	
	\end{tabular}
	\label{tab:hw_val_dip_testplan}
\end{table}
\newpage
\begin{table}[h!]
	\begin{tabular}{llp{12.25cm}c}
	\toprule
	\textbf{\#}	& \textbf{Naam} & \textbf{Verwachte resultaat} & \textbf{Voltooid}\\ \toprule
	\multicolumn{4}{l}{Analoge input signaal} \\ \midrule 
	12 			& AI1			& Als de schakelaar PU1 van de schakelaar aangezet wordt dan zal het data bereik op de graphical user interface aangepast worden naar 0 tot 4096. Als de dip schakelaar uit staat dan zal het bereik maar van 0 tot 1100 gaan. & X\\
	13 			& AI2			& Als de schakelaar PU1 van de schakelaar aangezet wordt dan zal het data bereik op de graphical user interface aangepast worden naar 0 tot 4096. Als de dip schakelaar uit staat dan zal het bereik maar van 0 tot 1100 gaan. & X\\
	14 			& AI3			& Als de schakelaar PU1 van de schakelaar aangezet wordt dan zal het data bereik op de graphical user interface aangepast worden naar 0 tot 4096. Als de dip schakelaar uit staat dan zal het bereik maar van 0 tot 1100 gaan. & X\\ \midrule
	\multicolumn{4}{l}{Relay} \\ \midrule
	15 			& Relay			& De microcontroller zet de pin van de relay voor vijf seconden hoog, als dit gebeurt hoor je een klik te horen. Na vijf seconden zal deze pin weer laag gezet worden, dit moet ook gehoord kunnen worden. & X \\ \midrule
	\multicolumn{4}{l}{Seriële communicatie} \\ \midrule
	16 			& UART			& \multirow{4}{12.25cm}{GUI vraagt om gebruikersinput, dit wordt opgestuurd naar de Satelitte, de Satelitte behandelt de data. De Satelitte zal een bericht terugsturen met wat de Satellite heeft ontvangen.} & X \\
	17 			& RS-232		& & X \\
	18 			& RS-422		& & X \\
	19 			& UART 2		& & X \\  \bottomrule
	\end{tabular}
\end{table}


\subsection{Applicatie}
De grootste doelstelling van de afstudeeropdracht is om een generieke applicatie te ontwikkelen. Hiervoor is een applicatie ontworpen en geschreven volgens de eisen die Sensor Maritime heeft opgesteld. De vraag vanuit Sensor Maritime was om een applicatie te ontwikkelen waar kapiteins plug and play sensoren in de Satellite kunnen stoppen. Hiervoor zijn verschillende doelstellingen opgesteld die als volgt gaan:
\begin{enumerate}
	\item De Satellite heeft een robuuste communicatie over CAN en UDP.
	\item Generiek en modulair opgebouwd software, waardoor het in de toekomst makkelijk uitgebreid kan worden.
\end{enumerate}

\noindent Beide doelstellingen beantwoorden de vraag, hoe kan er een generieke applicatie ontwerp en robuuste communicatie bedacht worden. Het uiteindelijke resultaat hiervan is een applicatie die generiek is opgebouwd en de het structuur volgt zoals het ontworpen is. Dit bestaat uit een aantal grote onderdelen. Ten eerste is er een applicatielogica ontworpen wat aan de hand van de states \ref{fig:appstates} is toegevoegd. Voor de tijdsinvariant taken zijn interrupts gebruikt, een interrupt is responsie van de microcontroller bij een event. Een event kan bijvoorbeeld zijn dat een pin hoog gezet wordt. Elke interrupt leest de data uit zodra deze interrupt aangeroepen wordt. Bij tijdsvariant systeem is er gebruit gemaakt van een timer. Dit houdt de timing bij op hardware niveau, en door de ontwikkelaar gespecificeerde functie wordt door de timer aangeroepen. \newline

\noindent Daarnaast zijn verschillende sensoren geïmplementeerd die Sensor Maritime uitgekozen heeft. Deze sensoren waren imu, altimeter, GNSS en inductor. Als deze sensoren aan de Satellite gekoppeld zijn en de preprocessor de sensordefinitie heeft, dan zal de sensor uitgelezen worden. Hier wordt een packet van gemaakt en dit wordt uiteindelijk elke seconden opgestuurd. Wanneer sensor data opgehaald wordt, er een groen ledje getoond, gevolgd door een blauw ledje dat er sensor data opgestuurd is. \newline

\noindent Vervolgens is de communicatie toegevoegd. De Satellite heeft twee vormen van communicatie, UDP en CAN-Bus. UDP op het moment stuurt voor elke sensor elke seconde sensor data op. De UDP-communicatie stuurt op het moment alleen data op, en ontvangt niet. CAN-bus is veel uitgebreider op het moment, het moet ten eerste ontvangen en opsturen. CAN-Bus werkt met een ontvang en antwoord systeem. Het kan verschillende type berichten ontvangen die verschillende dingen kan vragen aan de Satellite. Dit betekent dat de CAN-communicatie goed moet kijken wat het ontvangt en hoe het moet antwoorden. Beide werken robuust en kunnen communiceren met een hoofdsysteem. Bij eventuele fouten of waarschuwingen wordt de rode of gele LED getoond. 

\newpage
\section{Eisen}
In dit onderdeel zal er gekeken worden in hoe ver de huidige applicatie voldoet aan de eisen die opgesteld zijn in de MosCoW analyse \ref{tab:eisen} bij de probleemanalyse. Er zal als eerste gekeken worden naar de must have eisen in de volgende tabel \ref{tab:must}. Alle must have eisen zijn geïmplementeerd. SM1 is uitgevoerd met de hulp van het testplan voor de hardwarevalidatie, het resultaat van de eis is dat er een testplan, software voor de Satellite en een desktopapplicatie is ontwikkeld. SM2 is een sensor implementatie waarbij de IMU uitgelezen moest worden. Dit is de eerste sensor die uitgewerkt is. De IMU wordt op dit moment uitgelezen om de 100 milliseconden en om de 1 seconden opgestuurd naar een hoofdsysteem. De IMU geeft de gemiddelde, minimale en maximale van versnellingsas, daarnaast wordt ook nog een hoekmeting gedaan. SM4 en SM5 zijn aan elkaar gekoppeld. Hiervoor zijn verschillende methodes toegepast, bijvoorbeeld foutafhandeling en ook aanpassingen gemaakt aan een originele structuur om de robuustheid te verbeteren. 

\begin{table}[h!]
	\centering
	\caption{MoSCoW Analyse resultaat must haves}
	\label{tab:must}
	\begin{tabular}{lp{15cm}}
	\toprule
	\textbf{ID} & \textbf{Eis} \\ \midrule
	SM1			& Alle IO porten van de Satellite moeten getest worden 										\\
	SM2			& Implementatie van de hoekmeting en versnellingsassen 										\\ 
	SM3			& Spectrum analyse maken van de versnellingsassen 											\\ 
	SM4			& Errors moeten goed afgevangen worden, de applicatie mag niet crashen of blijven hangen 	\\ 
	SM5			& CAN-implementatie, en correcte protocol afhandeling										\\ \bottomrule
	\end{tabular}
\end{table}

\noindent Buiten de must haves zijn de volgende eisen \ref{tab:shouldetc} geïmplementeerd in de applicatie. Deze twee eisen hebben uiteindelijk voorrang gekregen over SM3 aangezien de klant dit vroeg. De hoogte sensor en antenne sensor worden nu uitgelezen en om de seconden opgestuurd via UDP. Voor de hoogte sensor wordt het gemiddelde berekent van 1 seconden en dit wordt dan opgestuurd. De antenne sensor meet metaaldetectie en stuurt dit op, dit wordt op true/false manier getoond. De waarde is true als de waarde hoger is dan 4080, en de waarde is false als de waarde rond de 0 is. Daarnaast is er ook een standaard datastructuur ontwikkeld voor de CAN-Bus. Hiervoor is een ontwerp gemaakt en dit is geïmplementeerd. 

\begin{table}[h!]

\centering
	\caption{MoSCoW Analyse resultaat overig}
	\label{tab:shouldetc}
	\begin{tabular}{lp{13cm}l}
	\toprule
	\textbf{ID} & \textbf{Eis} & \textbf{Prioriteit}\\ \midrule
	SM7			& Hoogte sensoren en antenne sensor inlezen 				 & SHOULD \\  \midrule
	SM8			& Standaard datastructuur voor packets die worden opgestuurd & COULD	 \\\bottomrule
	\end{tabular}
\end{table}


